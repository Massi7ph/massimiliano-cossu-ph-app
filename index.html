<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Massimiliano Cossu | Photography</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; text-align: center; margin: 0; padding: 20px; color: #000; }
        .container { max-width: 500px; margin: 0 auto; }
        h1 { font-size: 1rem; letter-spacing: 4px; text-transform: uppercase; margin-bottom: 40px; }
        
        /* BOX METEO */
        .weather { padding: 20px; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; margin-bottom: 30px; }
        .temp { font-size: 3rem; font-weight: 300; margin: 10px 0; }
        
        /* BOX AI */
        .chat-box { background: #f9f9f9; padding: 20px; border-radius: 8px; text-align: left; margin-bottom: 30px; }
        #ai-response { font-size: 0.9rem; line-height: 1.5; min-height: 60px; margin-bottom: 15px; }
        .input-group { display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button.ask-btn { padding: 10px 20px; background: #000; color: #fff; border: none; cursor: pointer; }
        
        /* FORM CONTATTI */
        .form-title { font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; font-weight: 600; }
        input.field, textarea.field { width: 100%; padding: 15px; margin-bottom: 10px; border: 1px solid #eee; box-sizing: border-box; }
        button.send-btn { width: 100%; padding: 15px; background: #000; color: #fff; border: none; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>Massimiliano Cossu</h1>

    <div class="weather">
        <div style="font-size: 0.7rem; color: #888;">IMPERIA, OGGI</div>
        <div class="temp" id="temp">--°C</div>
        <div id="desc" style="text-transform: uppercase; font-size: 0.7rem;">Caricamento...</div>
    </div>

    <div class="chat-box">
        <div id="ai-response"><strong>AI:</strong> Ciao, sono l'assistente virtuale. Chiedimi un consiglio su location o outfit in base al meteo di oggi!</div>
        <div class="input-group">
            <input type="text" id="question" placeholder="Es: Che outfit consigli oggi?">
            <button class="ask-btn" onclick="inviaDomanda()">INVIA</button>
        </div>
    </div>

    <div class="form-title">Richiedi Disponibilità</div>
    <form id="contact-form">
        <input type="text" id="fn" class="field" placeholder="NOME" required>
        <input type="email" id="em" class="field" placeholder="EMAIL" required>
        <input type="tel" id="ph" class="field" placeholder="TELEFONO" required>
        <input type="text" id="rn" class="field" placeholder="HOTEL / CAMERA">
        <textarea id="nt" class="field" placeholder="NOTE" style="height: 80px;"></textarea>
        <button type="submit" class="send-btn" id="sb">INVIA RICHIESTA</button>
    </form>
</div>

<script>
    // --- 1. CONFIGURAZIONE ---
    // INCOLLA QUI LA TUA NUOVA CHIAVE API (Mantieni le virgolette!)
    const API_KEY = "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"; 
    
    emailjs.init("Jlm5ZEzPEoWKBx3ki"); // Il tuo ID pubblico corretto

    // Variabili meteo
    let meteoAttuale = "non disponibile";
    let tempAttuale = "--";

    // --- 2. FUNZIONE METEO AUTOMATICA ---
    async function getMeteo() {
        try {
            const res = await fetch("https://api.openweathermap.org/data/2.5/weather?q=Imperia,IT&appid=f1cdab2eef339087f342360bdd4958cf&units=metric&lang=it");
            const data = await res.json();
            tempAttuale = Math.round(data.main.temp);
            meteoAttuale = data.weather[0].description;
            document.getElementById('temp').innerText = tempAttuale + "°C";
            document.getElementById('desc').innerText = meteoAttuale;
        } catch(e) { console.log("Errore meteo"); }
    }
    getMeteo(); // Avvia subito il meteo

    // --- 3. FUNZIONE AI (CHAT) ---
    async function inviaDomanda() {
        const input = document.getElementById('question');
        const output = document.getElementById('ai-response');
        const testo = input.value;
        if(!testo) return;

        output.innerHTML = "<em>Sto pensando...</em>";
        input.value = ""; // Pulisci campo

        // Prompt di sistema intelligente
        const sistema = `Sei l'AI Concierge del fotografo Massimiliano Cossu a Imperia.
        Meteo attuale: ${tempAttuale}°C, ${meteoAttuale}.
        
        REGOLE:
        - Se piove/coperto: Consiglia i "Portici di Oneglia" (luce morbida, riparati).
        - Se c'è sole: Consiglia il "Parrasio" (vicoli storici) o "Borgo Foce" (mare).
        - Outfit: Elegante, colori neutri (lino, beige, bianco).
        - Tono: Professionale, sintetico (max 2 frasi).`;

        try {
            const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + API_KEY
                },
                body: JSON.stringify({
                    model: "gpt-4o-mini", // Modello veloce ed economico
                    messages: [
                        { role: "system", content: sistema },
                        { role: "user", content: testo }
                    ]
                })
            });

            const data = await response.json();
            
            if(data.error) {
                output.innerHTML = "Errore Chiave API: Controlla di aver messo quella nuova.";
            } else {
                output.innerHTML = "<strong>AI:</strong> " + data.choices[0].message.content;
            }

        } catch(err) {
            output.innerHTML = "Errore di connessione.";
        }
    }

    // --- 4. FUNZIONE INVIO EMAIL (EmailJS) ---
    document.getElementById('contact-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('sb');
        btn.innerText = "ATTENDERE...";
        
        const params = {
            from_name: document.getElementById('fn').value,
            name: document.getElementById('fn').value,
            email: document.getElementById('em').value,
            phone: document.getElementById('ph').value,
            room_number: document.getElementById('rn').value,
            notes: document.getElementById('nt').value,
            requested_time: "Da Web App"
        };

        emailjs.send("default_service", "template_liqxtir", params)
        .then(function() {
            alert("Inviato con successo!");
            btn.innerText = "INVIATO";
        }, function(error) {
            alert("Errore: " + JSON.stringify(error));
            btn.innerText = "Riprova";
        });
    });
</script>

</body>
</html>
